---
import { Picture } from '@astrojs/image/components';
import { imgUrlFor } from '@raulmelo/core/utils';

import { sanityClient } from '@/infrastructure/sanity/client';
import {
  calculateAspectRatio,
  scaleDownImageSize,
} from '@/infrastructure/utils/image';

type Props = {
  node: {
    caption: string;
    image: {
      url: string;
      width: number;
      height: number;
    };
  };
};

const {
  node: { image, caption },
} = Astro.props;

const { url, width, height, aspectRatio } = imgUrlFor(sanityClient, image);


---

<Picture
class="object-cover mx-auto"
src={url}
aspectRatio={aspectRatio}
widths={[200, 400, 640, 768, width]}
sizes={`(max-width: ${width}px) 100vw, ${width}px`}
alt={caption}
width={width}
height={height}
/>